package tests;

import Utils.RetryAnalyzer;
import org.openqa.selenium.*;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.support.ui.*;
import org.testng.Assert;
import org.testng.annotations.*;

import java.time.Duration;

public class UrlOpenTest {

    WebDriver driver;

    @BeforeClass
    public void setUpBrowser() {
        driver = new ChromeDriver();
        driver.manage().window().maximize();
        String url = "https://qa-practice.netlify.app/bugs-form.html";
        driver.get(url);
    }

    @Test(retryAnalyzer = RetryAnalyzer.class)
    public void shouldLoadBugReportFormUrlSuccessfully() {
        String pageTitle = driver.getTitle();
        System.out.println("Page Title: " + pageTitle);
        Assert.assertTrue(pageTitle.toLowerCase().contains("qa"), "Page title does not contain 'QA'");
        Assert.assertTrue(pageTitle.toLowerCase().contains("QA"), "Page title does not contain 'QA'");
    }

    @Test(dataProvider = "userDataProvider", description = "Register a user by filling the bug form with different test data")
    public void RegisterUser(String firstName, String lastName, String phone, String country, String email, String password) {
        String actualUrl = driver.getCurrentUrl();
        String expectedUrl = "https://qa-practice.netlify.app/bugs-form.html";
        Assert.assertEquals(actualUrl, expectedUrl, "URLs do not match");

        // Fill out the form
        driver.findElement(By.id("firstName")).clear();
        driver.findElement(By.id("firstName")).sendKeys(firstName);

        driver.findElement(By.id("lastName")).clear();
        driver.findElement(By.id("lastName")).sendKeys(lastName);

        driver.findElement(By.id("phone")).clear();
        driver.findElement(By.id("phone")).sendKeys(phone);

        Select countryDropdown = new Select(driver.findElement(By.id("countries_dropdown_menu")));
        countryDropdown.selectByVisibleText(country);

        driver.findElement(By.id("emailAddress")).clear();
        driver.findElement(By.id("emailAddress")).sendKeys(email);

        driver.findElement(By.id("password")).clear();
        driver.findElement(By.id("password")).sendKeys(password);

        // Enable and click checkbox
        WebElement checkbox = driver.findElement(By.id("exampleCheck1"));
        if (!checkbox.isEnabled()) {
            ((JavascriptExecutor) driver).executeScript("document.getElementById('exampleCheck1').disabled = false;");
        }
        checkbox.click();

        // Submit
        WebElement registerBtn = driver.findElement(By.id("registerBtn"));
        registerBtn.click();

        // Wait and validate result
        WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(5));
        WebElement resultSection = wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("results-section")));
        Assert.assertTrue(resultSection.isDisplayed(), "Result section was not displayed after submission!");
        System.out.println("Result Section Text:\n" + resultSection.getText());

    }

    @DataProvider(name = "userDataProvider")
    public Object[][] userDataProvider() {
        return new Object[][]{
                {"Paran", "jyothi", "9898454566", "Canada", "sample@gmail.com", "Paranjyothi1234"},
                {"John", "Doe", "9876543210", "India", "john.doe@example.com", "JohnDoe@123"},
                {"Alice", "Smith", "9988776655", "Australia", "alice.smith@example.com", "Alice2024"}
        };
    }

    @AfterClass
    public void tearDownBrowser() {
        if (driver != null) {
            driver.quit();
        }
    }
}
